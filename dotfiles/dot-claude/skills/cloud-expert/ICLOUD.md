# iCloud Drive Backend Reference

## Status

**Tier 4: Experimental.** The iCloud Drive backend (`iclouddrive`) is experimental and may have bugs or missing features. Use with caution for critical data.

## Authentication

### Password Requirements
- Use your **regular Apple ID password** (not an app-specific password)
- App-specific passwords do **not** work with the iCloud Drive API
- 2FA is **mandatory** — you must complete the 2FA challenge during setup

### Trust Token
- After successful 2FA, rclone stores a trust token in config
- Trust token is valid for **~30 days**
- After expiry: `rclone reconnect iclouddrive:` to re-authenticate with 2FA
- Token refresh is **not automatic** — requires manual intervention

### Setup
```bash
rclone config
# → New remote
# → Type: iclouddrive
# → apple_id: your@icloud.com
# → password: (your Apple ID password)
# → Complete 2FA challenge
```

### Config Example
```ini
[icloud]
type = iclouddrive
apple_id = your@icloud.com
password = <obscured>
trust_token = <auto-generated>
```

## Required Account Settings

### Advanced Data Protection (ADP)
**ADP MUST be disabled** for rclone to access iCloud Drive. ADP encrypts iCloud data end-to-end, which prevents third-party API access.

To check/disable:
1. Settings → Apple ID → iCloud → Advanced Data Protection
2. Turn off (if enabled)

### iCloud Web Access
**"Access iCloud Data on the Web" MUST be enabled.**

1. Settings → Apple ID → iCloud
2. Enable "Access iCloud Data on the Web"

Without this, the API endpoints rclone uses are not available.

## Capabilities

### What Works
- List files and directories
- Upload files
- Download files
- Delete files
- Create directories
- Move/rename files

### What Doesn't Work or Is Unreliable
- No server-side copy
- No hash checking (no checksums available)
- Large file uploads may timeout
- No shared folder access
- Performance is slower than OneDrive/Google Drive
- No delta/incremental listing

## Limitations

| Limit | Value |
|-------|-------|
| Max file size | Limited by timeout (practical ~10 GiB) |
| API rate limits | Undocumented, conservative recommended |
| Trust token validity | ~30 days |
| Concurrent connections | Low (reduce `--transfers` to 2-3) |

## Best Practices

1. **Keep transfers low:** `--transfers 2 --checkers 4` to avoid rate limits
2. **Monitor trust token:** Set a reminder to run `rclone reconnect` before 30 days
3. **Don't use for primary sync:** Experimental status means data loss risk
4. **Prefer macOS native:** For daily iCloud use, the native Finder integration is more reliable
5. **Backup use case:** Best suited for periodic backups/downloads from iCloud, not continuous sync
6. **Test first:** `rclone lsd icloud: --max-depth 1` to verify access before any sync operation

## Troubleshooting

### "Authentication failed"
- Verify Apple ID password (not app-specific)
- Complete 2FA challenge
- Check ADP is disabled
- Check web access is enabled

### "Trust token expired"
```bash
rclone reconnect icloud:
# Complete 2FA again
```

### Slow performance
- Reduce `--transfers` to 2
- Reduce `--checkers` to 4
- Use `--bwlimit` to be gentle on Apple's servers
- Avoid `--fast-list` (not supported, ignored)
